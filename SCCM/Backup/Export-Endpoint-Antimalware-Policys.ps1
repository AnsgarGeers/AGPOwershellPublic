#
# Press 'F5' to run this script. Running this script will load the ConfigurationManager
# module for Windows PowerShell and will connect to the site.
#
# This script was auto-generated at '24.08.2017 10:05:34'.

# Uncomment the line below if running in an environment where script signing is 
# required.
#Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

Import-Module "$($ENV:SMS_ADMIN_UI_PATH)\..\ConfigurationManager.psd1" # Import the ConfigurationManager.psd1 module 
Set-Location "XXX:" # Set the current location to be the site code.

$exportpath = "F:\PSBACKUP\Antimalware"

$policys = (Get-CMAntimalwarePolicy).SettingsID
IF(!(test-path -Path $exportpath))
{
    New-Item -Path $exportpath -ItemType Directory -Force
}


Foreach ($Policy in $policys)
{
    $pol = Get-CMAntimalwarePolicy -Id $policy
    IF($pol.Priority -ne "10000")
    {  
        $name = "$($pol.Priority)_$($((($pol.name).Replace(" | ","_"))).replace("| ","_"))"
        Export-CMAntiMalwarePolicy -InputObject $pol -Path "$exportpath\$name.xml"
    }
}
